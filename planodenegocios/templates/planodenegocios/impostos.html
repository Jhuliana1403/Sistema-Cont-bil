{% extends "base.html" %}
{% load static %}

{% block conteudo %}
<!-- Exibir mensagens de erro ou sucesso -->
{% if messages %}
<div class="messages">
    {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
</div>
<script src="{% static 'js/delay_error.js' %}"></script>
{% endif %}
<div class="container my-5">
  <div class="card shadow-lg border-0">
    <div class="card-body">

      <h2 class="card-title text-center mb-3">Impostos</h2>
      <p class="text-muted text-center mb-3">
        Use as opções e o quadro a seguir para configurar as alíquotas de impostos que incidem
        sobre as vendas de produtos e serviços e sobre o lucro apurado.
      </p>

      <form method="POST">
        {% csrf_token %}

        <div class="d-flex gap-4 mb-3 justify-content-center">
          <label class="form-check">
            <span class="ms-1">A mesma alíquota do início ao fim do período.</span>
          </label>
        </div>

        <div class="table-responsive rounded">
          <table class="table table-hover table-bordered align-middle text-center shadow-sm bg-white rounded">
            <thead class="table-primary text-dark">
              <tr>
                <th class="text-start">Sobre o lucro apurado</th>
                {% for col in lucro_cols %}
                  <th>Ano {{ col.ano }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-start">Alíquota média de impostos sobre o lucro (%)</td>
                {% for col in lucro_cols %}
                  <td>
                    <input type="number" step="0.01" min="0" max="100"
                           class="form-control form-control-sm text-end"
                           name="pl_{{ col.ano }}"
                           value="{{ col.valor_str }}"
                           {% if modo == 'const' and not forloop.first %}readonly{% endif %}>
                  </td>
                {% endfor %}
              </tr>

              <tr class="table-secondary fw-bold">
                <td class="text-start">Sobre vendas de produtos e serviços</td>
                {% for col in lucro_cols %}
                  <td>Ano {{ col.ano }}</td>
                {% endfor %}
              </tr>

              {% for l in linhas %}
                <tr>
                  <td class="text-start">{{ l.nome }}</td>
                  {% for col in l.cols %}
                    <td>
                      <input type="number" step="0.01" min="0" max="100"
                             class="form-control form-control-sm text-end"
                             name="pv_{{ l.id }}_{{ col.ano }}"
                             value="{{ col.valor_str }}"
                             {% if modo == 'const' and not forloop.first %}readonly{% endif %}>
                    </td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="d-flex justify-content-end mt-3">
          <button type="submit" class="btn-salvar">Salvar</button>
        </div>
      </form>

    </div>
  </div>
</div>
{% endblock conteudo %}

{% block extra_js %}
  <script src="{% static 'js/sidebar.js' %}"></script>
{% endblock extra_js %}
