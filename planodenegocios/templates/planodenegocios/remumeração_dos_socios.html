{% extends "base.html" %}
{% load static %}
{% load custom_tags %}

{% block conteudo %}
<div class="container my-5">
  <div class="card shadow-lg border-0">
    <div class="card-body">

      <!-- Tabs estilo moderno -->
      <div class="tabs-modern mb-4 d-flex gap-2 justify-content-center">
        <button class="tab-btn tab-btn-active">Remuneração dos Sócios</button>
        <a href="{% url 'valores' %}" class="tab-btn text-decoration-none">Valores</a>
        
      </div>

      <h2 class="card-title text-center mb-3">Distribuição de Lucros e Dividendos</h2>
      <p class="text-muted text-center mb-4">Indique para quem serão distribuídos eventuais lucros/dividendos apurados pelo empreendimento.</p>

      <form method="POST" novalidate>
        {% csrf_token %}

        <div class="table-responsive rounded">
          <table class="table table-hover table-bordered align-middle text-center shadow-sm bg-white rounded" id="tabela-socios">
            <thead class="table-primary text-dark">
              <tr>
                <th>Sócio</th>
                <th>Valor Inicial (mês 1)</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              {% if distribuicoes %}
                {% for dist in distribuicoes %}
                <tr>
                  <td>
                    <input type="text" name="socio_{{ forloop.counter }}" value="{{ dist.socio.nome }}" class="form-control form-control-sm" placeholder="Digite o nome do sócio">
                  </td>
                  <td>
                    <div class="input-group input-group-sm">
                      <span class="input-group-text">R$</span>
                      <input type="text" name="valor_{{ forloop.counter }}" value="{{ dist.valor_inicial|floatformat:2|stringformat:"s" }}" class="form-control text-end" placeholder="0,00">
                    </div>
                  </td>
                  <td>
                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="removerLinha(this)">
                      <i class="bi bi-trash-fill"></i>
                    </button>
                  </td>
                </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td>
                    <input type="text" name="socio_1" class="form-control form-control-sm" placeholder="Digite o nome do sócio">
                  </td>
                  <td>
                    <div class="input-group input-group-sm">
                      <span class="input-group-text">R$</span>
                      <input type="text" name="valor_1" class="form-control text-end" placeholder="0,00">
                    </div>
                  </td>
                  <td>
                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="removerLinha(this)">
                      <i class="bi bi-trash-fill"></i>
                    </button>
                  </td>
                </tr>
              {% endif %}
            </tbody>
            <tfoot>
              <tr>
                <td colspan="3" class="text-end">
                  <button type="button" class="btn btn-outline-primary btn-sm" onclick="adicionarLinha()">
                    <i class="bi bi-plus-circle"></i> Adicionar Sócio
                  </button>
                </td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="text-end mt-4">
          <button type="submit" class="btn btn-primary">Salvar</button>
          <a href="javascript:history.back()" class="btn btn-outline-secondary ms-2">Cancelar</a>
        </div>
      </form>

    </div>
  </div>
</div>
{% endblock conteudo %}

{% block extra_js %}
  <script src="{% static 'js/sidebar.js' %}"></script>
  <script>
    // Define o contador iniciando no número de linhas já existentes + 1
    let contador = {{ distribuicoes|length|default:1 }} + 1;

    function adicionarLinha() {
      const tabela = document.querySelector("#tabela-socios tbody");
      const novaLinha = document.createElement("tr");
      novaLinha.innerHTML = `
        <td>
          <input type="text" name="socio_${contador}" class="form-control form-control-sm" placeholder="Digite o nome do sócio">
        </td>
        <td>
          <div class="input-group input-group-sm">
            <span class="input-group-text">R$</span>
            <input type="text" name="valor_${contador}" class="form-control text-end" placeholder="0,00">
          </div>
        </td>
        <td>
          <button type="button" class="btn btn-outline-danger btn-sm" onclick="removerLinha(this)">
            <i class="bi bi-trash-fill"></i>
          </button>
        </td>
      `;
      tabela.appendChild(novaLinha);
      contador++;
    }

    function removerLinha(botao) {
      const linha = botao.closest("tr");
      linha.remove();
    }
  </script>
  <script src="{% static 'js/sidebar.js' %}"></script>
  <script src="{% static 'js/adicionar_linha.js' %}"></script>
  <script src="{% static 'js/botao-ativacao.js' %}"></script>
  <script src="{% static 'js/calculo-markup.js' %}"></script>
{% endblock extra_js %}
